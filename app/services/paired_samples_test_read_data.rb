class PairedSamplesTestReadData
  def self.base_object
    object = {
      products: [
        "BT90",
        "BM62",
        "ZL85",
        "SH37",
        "FF29",
        "AX46",
        "KO51",
        "CJ13"
      ],

      questions: {
        "Q1": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q1.TOPBOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q1.TOP2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q1.BOTTOM2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q2.JR": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q2.STRONG": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q2.WEAK": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q5": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q5.TOPBOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q5.TOP2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q5.BOTTOM2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q6.JR": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q6.STRONG": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q6.WEAK": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q7": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q7.TOPBOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q7.TOP2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q7.BOTTOM2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q8.JR": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q8.STRONG": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
        "Q8.WEAK": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q9": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q9.TOPBOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q9.TOP2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q9.BOTTOM2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q10.1": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q10.2": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q10.3": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q10.4": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q10.5": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q10.6": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q10.7": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q11.1": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q11.1.TOPBOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q11.1.TOP2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q11.1.BOTTOM2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q11.2": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q11.2.TOPBOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q11.2.TOP2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },

        "Q11.2.BOTTOM2BOX": {
          "BT90": { means: 0.0 },
          "BM62": { means: 0.0 },
          "ZL85": { means: 0.0 },
          "SH37": { means: 0.0 },
          "FF29": { means: 0.0 },
          "AX46": { means: 0.0 },
          "KO51": { means: 0.0 },
          "CJ13": { means: 0.0 }
        },
      }
    }
  end

  def self.read_file(object, data_file)
    xlsx = Roo::Spreadsheet.open(data_file)
    xlsx.each_with_pagename do |name, sheet|
      name = nil
      des_flag = false
      homo_flag = false
      anova_flag = false
      posthoc_flag = false
      tukey_flag = false
      dunnett_flag = false
      tukey_key = nil
      dunnett_key = nil

      sheet.each_with_index do |row, index|
        p index
        next if (row.reject { |x| x.nil? }).empty?
        name = name || nil
        if row[0].to_s.start_with?("ONEWAY")
          object.questions.keys.each do |question|
            if row[0].to_s.upcase().include?("#{question.to_s.upcase().split(" ").join(" ").to_s} ")
              name = question
              object.products.keys.each do |p|
                object.products[p][name] = {}
              end
              des_flag = false
              homo_flag = false
              anova_flag = false
              posthoc_flag = false
              tukey_flag = false
              dunnett_flag = false
              tukey_key = nil
              dunnett_key = nil
            end
          end
        end
        # Đọc Mean của các Products
        if row[0].present? && row[0].class == String && row[0].include?(object.descriptives)
          des_flag = true
          next
        end

        if des_flag
          object.questions[name][:warnings] = true if sheet.row(index-4)[0].to_s == "Warnings"
          object.products.keys.each do |p|
            object.products[p][name][:mean] = ( row[2].to_f <= 1.0 ?  ( row[2] == "." ? "." : row[2].to_f  * 100 ) : row[2].to_f ) if row[0].to_s.split(" ").join(" ") == p && object.products[p][name][:mean].nil?
          end
        end

        if des_flag && row[0].present? && row[0].class == String && row[0].include?(object.homogeneity)
          des_flag = false
          homo_flag = true
          object.questions[name][:homogeneity_sig] = sheet.row(index+4)[3].to_f
          next
        end

        if homo_flag && row[0].present? && row[0].class == String && row[0].include?(object.anova)
          homo_flag = false
          anova_flag = true
          object.questions[name][:anova_sig] = sheet.row(index+4)[5].to_f
          next
        end

        if anova_flag && row[0].present? && row[0].class == String && row[0].include?(object.posthoc)
          anova_flag = false
          posthoc_flag = true
          next
        end

        if posthoc_flag && row[0].present? && row[0].class == String && row[0].include?(object.tukey_hsd)
          posthoc_flag = false
          tukey_flag = true
        end # Rows in Sheet

        if tukey_flag && row[0].present? && row[0].class == String && row[0].include?(object.dunnett_t3)
          tukey_flag = false
          dunnett_flag = true
        end

        col = 2 # IMPORTANT, You have to change it based on data

        if tukey_flag
          object.products.keys.each do |key|
            tukey_key = key if row[col].to_s.split(" ").join(" ") == key
          end
          if tuk
  def self.read_data_without_benchmark(object, data_file)
    xlsx = Roo::Spreadsheet.open(data_file)

    object.questions.each do |question|
      object.products.keys.each do |p|
        object.products[p][question.to_s] = {}
      end
    end

    xlsx.each_with_pagename do |name, sheet|
      object.questions.push name.to_s if object.questions.include?(name) == false && name.downcase.start_with?("sheet") == false

      st_flag, tt_flag, corr_flag = false, false, false
      bm_name = nil

      sheet.each_with_index do |row, index|
        p index
        next if (row.reject { |x| x.nil? }).empty?
        name = name || nil
        if row[0].to_s.downcase == "syntax"
          object.questions.each do |x|
            if row[2].to_s.include?("#{x}")
              # if row[2].to_s.include?("#{x}_E4A")
              name = x
              st_flag, tt_flag, corr_flag = false, false, false
              bm_name = nil
            end
          end
        end

        if row[0].to_s.downcase.include?(object.statistic_table)
          st_flag = true
          corr_flag = false
          next
        end

        if st_flag == true && corr_flag == false && ( row[0].to_s.downcase.start_with?("pair ") )
          # First Row is Benchmark Product
          # Second Row is Current Product
          bm_name = nil
          product_name = nil
          object.products.keys.each do |key|
            bm_name = key if row[1].include?(key)
            product_name = key if sheet.row(index+2)[1].include?(key)
          end

          object.products[bm_name][name][:mean] ||= (row[2].to_f > 1.0 ? row[2].to_f : (row[2] == "." ? "." : row[2].to_f * 100) )
          object.products[bm_name][name][:compare_with] ||= {}
          object.products[bm_name][name][:compare_with][product_name] ||= {}
          object.products[bm_name][name][:compare_with][product_name][:mean] ||= (sheet.row(index+2)[2].to_f > 1.0 ? sheet.row(index+2)[2].to_f : (sheet.row(index+2)[2] == "." ? "." : sheet.row(index+2)[2].to_f * 100) )

        end

        if row[0].to_s.downcase.include?(object.correlation)
          st_flag = false
          corr_flag = true
        end

        if row[0].to_s.downcase.include?(object.test_table)
          st_flag = false
          corr_flag = false
          tt_flag = true
          next
        end

        if tt_flag == true && st_flag == false && row[0].to_s.downcase.start_with?("pair ")
          product_name = nil
          object.products[bm_name][name][:compare_with].keys.each do |key|
            product_name = key if row[1].to_s.include?(key)
          end
          next if product_name.nil?
          current_product_mean = object.products[bm_name][name][:mean]
          compare_with_mean = object.products[bm_name][name][:compare_with][product_name][:mean]
          object.products[bm_name][name][:compare_with][product_name].merge!({
            score: row[9].to_f,
            test_80: ( row[9].to_f  < 0.2 ? (current_product_mean > compare_with_mean ? "W" : "L") : nil ),
            test_90: ( row[9].to_f  < 0.1 ? (current_product_mean > compare_with_mean ? "W" : "L") : nil ),
            test_95: ( row[9].to_f  < 0.05 ? (current_product_mean > compare_with_mean ? "W" : "L") : nil ),
            test_99: ( row[9].to_f  < 0.01 ? (current_product_mean > compare_with_mean ? "W" : "L") : nil )
          })
        end

      end # End Sheet

    end # End Sheets
    object
  end

  def self.read_data_with_benchmark(object, data_file)
    xlsx = Roo::Spreadsheet.open(data_file)

    object.questions.each do |question|
      object.benchmarks.keys.each do |p|
        object.benchmarks[p][question.to_s] = {}
      end
      object.products.keys.each do |p|
        object.products[p][question.to_s] = {}
      end
    end

    xlsx.each_with_pagename do |name, sheet|

      object.questions.push name.to_s if object.questions.include?(name) == false && name.downcase.start_with?("sheet") == false

      st_flag, tt_flag = false, false
      product_name = nil

      sheet.each_with_index do |row, index|
        p index
        next if (row.reject { |x| x.nil? }).empty?
        next if row[0].present? && row[0].start_with?("No statistics are computed for a split file")
        name = name || nil

        if row[0].to_s.downcase == "syntax"
          object.questions.each do |x|
            # if row[2].to_s.include?("#{x}_K5D")
              # if row[2].to_s.include?("#{x}_E4A")
            if row[2].to_s.include?("#{x}")
              name = x
              st_flag, tt_flag = false, false
              product_name = nil
            end
          end
        end

        product_name = 'Scale3'

        if row[0].to_s.downcase.start_with?("brand =")
          product_name = row[0].split("=").second.split(" ").join(" ")
          st_flag, tt_flag = false, false
          next
        end

        if row[0].to_s.downcase.include?(object.statistic_table)
          st_flag = true
          next
        end

        if st_flag == true && ( row[0].to_s.downcase.start_with?("pair ") || sheet.row(index)[0].to_s.downcase.start_with?("pair "))

          count = 0
          object.benchmarks.keys.each do |key|
            if (row[1].to_s.include?(name + "_") || row[1].to_s == name)&& object.benchmarks[key][name][:mean].nil?
               #if (row[1].to_s.include?(name) || row[1].to_s == name)&& object.benchmarks[key][name][:mean].nil?
              object.benchmarks[key][name][:mean] = (row[2].to_f > 1.0 ? row[2].to_f : (row[2] == "." ? "." : row[2].to_f * 100 ) ) if object.benchmarks[key][name][:mean].nil?
            else
              count += 1
            end
          end

      if count == object.benchmarks.keys.length && object.products[product_name][name][:mean].nil?
            object.products[product_name][name][:mean] = (row[2].to_f > 1.0 ? row[2].to_f : (row[2] == "." ? "." : row[2].to_f * 100) )
          end
        end

        if row[0].to_s.downcase.include?(object.test_table)
          st_flag = false
          tt_flag = true
          next
        end

        if tt_flag == true && st_flag == false
          object.products[product_name][name][:compare_with] ||= {}
          object.benchmarks.keys.each do |key|
            object.products[product_name][name][:compare_with][key] ||= {
              score: 0,
              test_80: nil,
              test_90: nil,
              test_95: nil,
              test_99: nil
            }
          end
        end

        if tt_flag == true && st_flag == false && row[0].to_s.downcase.start_with?("pair ")
          compare_with = nil
          object.benchmarks.keys.each do |key|
            compare_with = key if row[1].to_s.include?(key)
          end
          next if compare_with.nil?
          compare_with_mean = object.benchmarks[compare_with][name][:mean]

          current_product_mean = object.products[product_name][name][:mean] || 3.0
           if compare_with_mean.nil?

            compare_with_mean = current_product_mean
            current_product_mean = 3.0
          end
          object.products[product_name][name][:compare_with][compare_with] = {
            score: row[9].to_f,
            test_80: ( row[9].to_f  < 0.2 ? (current_product_mean > compare_with_mean ? "W" : "L") : nil ),
            test_90: ( row[9].to_f  < 0.1 ? (current_product_mean > compare_with_mean ? "W" : "L") : nil ),
            test_95: ( row[9].to_f  < 0.05 ? (current_product_mean > compare_with_mean ? "W" : "L") : nil ),
            test_99: ( row[9].to_f  < 0.01 ? (current_product_mean > compare_with_mean ? "W" : "L") : nil )
          }

        end
      end # End Sheet

    end # End

    object
  end # End Method
end
